
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>GeoServer “data dir” versioning &#8212; Python  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="geoserver-data-dir-versioning">
<h1>GeoServer “data dir” versioning<a class="headerlink" href="#geoserver-data-dir-versioning" title="Permalink to this headline">¶</a></h1>
<p>GeoServer stores its configuration files in a special directory, which everyone calls the “data dir” (but really, no GIS data should be stored in here …).
When someone updates the GeoServer configuration, XML files are modified in this directory, and the <strong>updateSequence</strong> value is incremented.</p>
<p>Why would you want to version this directory ?<br />
Well, we found several advantages to this, and now, we’re doing it everytime we deploy a new GeoServer instance:</p>
<ul class="simple">
<li><p>it’s a way to track changes when several people have admin rights,</p></li>
<li><p>it’s so much easier to rollback to a previous state,</p></li>
<li><p>one gets a better insight of what happens behind the scene,</p></li>
<li><p>it can turn into a backup solution,</p></li>
<li><p>it can fork a GeoServer instance into a testing one, then pull back the changes once OK,</p></li>
<li><p>it can distribute a config among a distributed stack of GeoServers</p></li>
<li><p>…</p></li>
</ul>
<section id="setting-up-the-repository">
<h2>Setting up the repository<a class="headerlink" href="#setting-up-the-repository" title="Permalink to this headline">¶</a></h2>
<section id="from-the-template-one">
<h3>From the template one<a class="headerlink" href="#from-the-template-one" title="Permalink to this headline">¶</a></h3>
<p>If you’re creating a new geoserver instance, you should really start from the “data dir” we provide:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="n">tomcat</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">georchestra</span><span class="o">/</span><span class="n">geoserver_minimal_data_dir</span><span class="o">.</span><span class="n">git</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">remote</span> <span class="n">rename</span> <span class="n">origin</span> <span class="n">upstream</span>
</pre></div>
</div>
<p>At this stage, you already have a local repository for your geoserver “data dir”.</p>
</section>
<section id="from-an-existing-data-dir">
<h3>From an existing “data dir”<a class="headerlink" href="#from-an-existing-data-dir" title="Permalink to this headline">¶</a></h3>
<p>In case you’re starting from an existing “data dir”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">init</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">add</span> <span class="o">--</span><span class="nb">all</span> <span class="o">.</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;initial repository state&quot;</span>
</pre></div>
</div>
<p>Let’s also ignore the changes to the <code class="docutils literal notranslate"><span class="pre">logs</span></code>, <code class="docutils literal notranslate"><span class="pre">temp</span></code>, <code class="docutils literal notranslate"><span class="pre">gwc</span></code> folders:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">cat</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">geoserver_data_dir</span><span class="o">/.</span><span class="n">gitignore</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span>
<span class="n">logs</span>
<span class="n">temp</span>
<span class="n">gwc</span>
<span class="n">EOF</span>
</pre></div>
</div>
<p>Also exclude folders containing datas if you don’t want them to be versioned.</p>
<p>Finally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">add</span> <span class="o">.</span><span class="n">gitignore</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;git ignores temp, logs and gwc folders&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="managing-the-repository">
<h2>Managing the repository<a class="headerlink" href="#managing-the-repository" title="Permalink to this headline">¶</a></h2>
<p>Easy steps if you’re familiar with git …</p>
<section id="commiting-changes">
<h3>Commiting changes<a class="headerlink" href="#commiting-changes" title="Permalink to this headline">¶</a></h3>
<p>There are two strategies: either you’re doing it manually (but this may soon become a pain), or you leave it to a cron task.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">add</span> <span class="o">--</span><span class="nb">all</span> <span class="o">.</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;my commit message&quot;</span>
</pre></div>
</div>
</section>
<section id="viewing-changes">
<h3>Viewing changes<a class="headerlink" href="#viewing-changes" title="Permalink to this headline">¶</a></h3>
<p>To view the commit history:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">log</span>
</pre></div>
</div>
<p>To identify the changes introduced by a revision:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">diff</span> <span class="n">xxxxxx</span>
</pre></div>
</div>
<p>… where xxxxxx is the commit hash.</p>
</section>
<section id="temporary-rollback">
<h3>Temporary rollback<a class="headerlink" href="#temporary-rollback" title="Permalink to this headline">¶</a></h3>
<p>Let’s say you want to temporarily rollback to a given revision.
First commit your working state (see above). Then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">xxxxxx</span>
</pre></div>
</div>
<p>Don’t forget you have to reload the geoserver catalog from the data dir.
This is done in the geoserver web interface with the “reload config” button.</p>
<p>To go back to the latest state:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">master</span>
</pre></div>
</div>
<p>… and reload the configuration again.</p>
</section>
<section id="complete-rollback">
<h3>Complete rollback<a class="headerlink" href="#complete-rollback" title="Permalink to this headline">¶</a></h3>
<p>This is achieved with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">reset</span> <span class="o">--</span><span class="n">hard</span> <span class="n">xxxxxx</span> <span class="o">--</span><span class="n">force</span>
</pre></div>
</div>
<p>… where xxxxxx is the revision hash you want to go to.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">--force</span></code> option will also discard any uncommited change.</p>
</section>
</section>
<section id="git-as-a-backup-solution">
<h2>Git as a backup solution<a class="headerlink" href="#git-as-a-backup-solution" title="Permalink to this headline">¶</a></h2>
<p>If your repository has a <code class="docutils literal notranslate"><span class="pre">remote</span></code> where you have the right to push to, git can easily turn into a backup solution for your data dir.</p>
<p>Check your remotes with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">geoserver_data_dir</span>
<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">remote</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>Either you have no remote or you may see something like this (in case you’re starting from our minimal data dir):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">upstream</span>	<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">georchestra</span><span class="o">/</span><span class="n">geoserver_minimal_data_dir</span><span class="o">.</span><span class="n">git</span> <span class="p">(</span><span class="n">fetch</span><span class="p">)</span>
<span class="n">upstream</span>	<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">georchestra</span><span class="o">/</span><span class="n">geoserver_minimal_data_dir</span><span class="o">.</span><span class="n">git</span> <span class="p">(</span><span class="n">push</span><span class="p">)</span>
</pre></div>
</div>
<p>Once your “origin” remote is setup, you don’t have to do this anymore.<br />
Just push the changes with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">tomcat</span> <span class="n">git</span> <span class="n">push</span> <span class="n">origin</span>
</pre></div>
</div>
<p>In case you opt for automatic backups with git, a cron job should regularly:</p>
<ul class="simple">
<li><p>add the changes</p></li>
<li><p>commit them</p></li>
<li><p>push the master branch to the remote repository</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Python</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/good_practices/geoserver_data_dir_versioning.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>